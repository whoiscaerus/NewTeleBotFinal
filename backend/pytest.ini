[pytest]
pythonpath = .
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
asyncio_mode = strict
# Enable asyncio debug mode to catch async issues
asyncio_debug = true
# Timeout Strategy: Two-Layer Approach
# =====================================
# Layer 1: Per-test timeout = 900 seconds (15 minutes)
#   - Kills individual tests that hang indefinitely
#   - With conftest.pytest_runtest_makereport hook: converts to SKIP instead of FAIL
#   - Tests are skipped, not failed, so CI/CD continues
#
# Layer 2: Workflow timeout = 300 minutes (5 hours, in .github/workflows/tests.yml)
#   - Ensures GitHub Actions job completes even if all tests hang
#   - Provides hard limit for entire test suite
#
# Result: CI/CD completes in ~45-60 min with full test results
# Hanging tests appear as SKIPPED for later investigation
timeout = 900
timeout_method = thread
addopts = -vv --maxfail=999 --durations=15 --showlocals --tb=short
markers =
    asyncio: mark test as requiring asyncio
    no_asyncio: mark test as NOT requiring asyncio (sync TestClient tests)
    timeout_prone: mark test as prone to timeouts in CI/CD environment
